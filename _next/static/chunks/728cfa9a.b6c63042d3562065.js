"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[102],{4840:function(e,t,r){r.d(t,{Q:function(){return eS},k:function(){return eh}});var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function a(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var s=function(){return(s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function i(e,t,r,n){return new(r||(r=Promise))(function(a,s){function i(e){try{o(n.next(e))}catch(t){s(t)}}function u(e){try{o(n.throw(e))}catch(t){s(t)}}function o(e){var t;e.done?a(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(i,u)}o((n=n.apply(e,t||[])).next())})}function u(e,t){var r,n,a,s,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(r)throw TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(u){s=[6,u],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}function o(e){return this instanceof o?(this.v=e,this):new o(e)}function c(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var n,a=r.apply(e,t||[]),s=[];return n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n;function i(e){a[e]&&(n[e]=function(t){return new Promise(function(r,n){s.push([e,t,r,n])>1||u(e,t)})})}function u(e,t){try{var r;r=a[e](t),r.value instanceof o?Promise.resolve(r.value.v).then(c,l):f(s[0][2],r)}catch(n){f(s[0][3],n)}}function c(e){u("next",e)}function l(e){u("throw",e)}function f(e,t){e(t),s.shift(),s.length&&u(s[0][0],s[0][1])}}function l(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=function e(t){var r="function"==typeof Symbol&&Symbol.iterator,n=r&&t[r],a=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&a>=t.length&&(t=void 0),{value:t&&t[a++],done:!t}}};throw TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,a){!function(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)}(n,a,(t=e[r](t)).done,t.value)})}}}var f=function(){function e(e,t,r){this.allowBoost=!1,this.string=e,this.marks=t,this.index=0,this.parseOptions=r}return e.prototype.hasMark=function(e){return void 0===e&&(e=0),this.index+e<this.marks.length},e.prototype.getMark=function(e){return void 0===e&&(e=0),this.marks[this.index+e]},e.prototype.shift=function(){this.index+=1},e.prototype.process=function(e){var t=this.marks[this.index];this.shift();var r=e[t.name];if(!r)throw Error("Unknown handler: ".concat(t.name));return r.call(e,this,t)},e.prototype.processString=function(){return this.shift(),this.processStringEnd()},e.prototype.processStringEnd=function(){var e=this.marks[this.index-1],t=this.marks[this.index];return this.shift(),this.string.slice(e.position,t.position)},e.prototype.slice=function(e){var t=this.marks[this.index].position;return this.string.slice(t,t+e)},e}(),p=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|([-+]\d{2}:\d{2}))$/;function h(e,t){for(var r=e.toString();r.length<t;)r="0".concat(r);return r}function d(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var y=function(){function e(e){this.pattern=e,this.patternRe=function(e){for(var t=[],r=0,n=e.split(".");r<n.length;r++){var a=n[r];"*"===a?t.push("[^.]+"):"**"===a?t.push(".*"):t.push(d(a))}return RegExp("^".concat(t.join("."),"$"))}(e)}return e.prototype.matches=function(e){return this.patternRe.test(e)},e.prototype.toJSON=function(){return this.pattern},e}(),b=function(){function e(e){this.type="stream",this.generator=e,this.ticker=null,this.isDone=!1,this.data=[]}return e.prototype.isArray=function(){return!0},e.prototype.get=function(){var e,t;return i(this,void 0,void 0,function(){var r,n,a,s,i,o,c;return u(this,function(u){switch(u.label){case 0:r=[],u.label=1;case 1:u.trys.push([1,7,8,13]),n=l(this),u.label=2;case 2:return[4,n.next()];case 3:if((a=u.sent()).done)return[3,6];return s=a.value,o=(i=r).push,[4,s.get()];case 4:o.apply(i,[u.sent()]),u.label=5;case 5:return[3,2];case 6:return[3,13];case 7:return e={error:u.sent()},[3,13];case 8:if(u.trys.push([8,,11,12]),!(a&&!a.done&&(t=n.return)))return[3,10];return[4,t.call(n)];case 9:u.sent(),u.label=10;case 10:return[3,12];case 11:if(e)throw e.error;return[7];case 12:return[7];case 13:return[2,r]}})})},e.prototype[Symbol.asyncIterator]=function(){return c(this,arguments,function(){var e;return u(this,function(t){switch(t.label){case 0:e=0,t.label=1;case 1:t.label=2;case 2:if(!(e<this.data.length))return[3,6];return[4,o(this.data[e])];case 3:return[4,t.sent()];case 4:t.sent(),t.label=5;case 5:return e++,[3,2];case 6:if(!this.isDone)return[3,8];return[4,o(void 0)];case 7:return[2,t.sent()];case 8:return[4,o(this._nextTick())];case 9:return t.sent(),[3,1];case 10:return[2]}})})},e.prototype._nextTick=function(){var e,t=this;if(this.ticker)return this.ticker;var r=function(){t.ticker=new Promise(function(t){e=t})},n=function(){e(),r()};return r(),i(t,void 0,void 0,function(){var e,t,r,a,s,i;return u(this,function(a){switch(a.label){case 0:a.trys.push([0,5,6,11]),e=l(this.generator()),a.label=1;case 1:return[4,e.next()];case 2:if((t=a.sent()).done)return[3,4];r=t.value,this.data.push(r),n(),a.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s={error:a.sent()},[3,11];case 6:if(a.trys.push([6,,9,10]),!(t&&!t.done&&(i=e.return)))return[3,8];return[4,i.call(e)];case 7:a.sent(),a.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return this.isDone=!0,n(),[2]}})}),this.ticker},e}(),v=function(){function e(e,t){this.data=e,this.type=t}return e.prototype.isArray=function(){return"array"===this.type},e.prototype.get=function(){return i(this,void 0,void 0,function(){return u(this,function(e){return[2,this.data]})})},e.prototype[Symbol.asyncIterator]=function(){if(Array.isArray(this.data))return function(e){var t,r,n;return u(this,function(n){switch(n.label){case 0:t=0,r=e,n.label=1;case 1:if(!(t<r.length))return[3,4];return[4,A(r[t])];case 2:n.sent(),n.label=3;case 3:return t++,[3,1];case 4:return[2]}})}(this.data);throw Error("Cannot iterate over: ".concat(this.type))},e}(),m=new v(null,"null"),w=new v(!0,"boolean"),g=new v(!1,"boolean"),k=function(){function e(e){this.date=e}return e.parseToValue=function(t){var r,n=p.test(t)?new Date(t):null;return n?new v(new e(n),"datetime"):m},e.prototype.equals=function(e){return this.date.getTime()==e.date.getTime()},e.prototype.add=function(t){var r=new Date(this.date.getTime());return r.setTime(r.getTime()+1e3*t),new e(r)},e.prototype.difference=function(e){return(this.date.getTime()-e.date.getTime())/1e3},e.prototype.compareTo=function(e){return this.date.getTime()-e.date.getTime()},e.prototype.toString=function(){var e,t,r,n,a,s,i,u,o;return t=h((e=this.date).getUTCFullYear(),4),r=h(e.getUTCMonth()+1,2),n=h(e.getUTCDate(),2),a=h(e.getUTCHours(),2),s=h(e.getUTCMinutes(),2),i=h(e.getUTCSeconds(),2),u="",0!=(o=e.getMilliseconds())&&(u=".".concat(h(o,3))),"".concat(t,"-").concat(r,"-").concat(n,"T").concat(a,":").concat(s,":").concat(i).concat(u,"Z")},e.prototype.toJSON=function(){return this.toString()},e}();function x(e){return Number.isFinite(e)?new v(e,"number"):m}function _(e){return new v(e,"string")}function E(e){return new v(e,"datetime")}function A(e){var t;return e&&"function"==typeof e.next?new b(function(){return c(this,arguments,function(){var t,r,n,a,s,i;return u(this,function(n){switch(n.label){case 0:n.trys.push([0,7,8,13]),t=l(e),n.label=1;case 1:return[4,o(t.next())];case 2:if((r=n.sent()).done)return[3,6];return[4,o(A(r.value))];case 3:return[4,n.sent()];case 4:n.sent(),n.label=5;case 5:return[3,1];case 6:return[3,13];case 7:return s={error:n.sent()},[3,13];case 8:if(n.trys.push([8,,11,12]),!(r&&!r.done&&(i=t.return)))return[3,10];return[4,o(i.call(t))];case 9:n.sent(),n.label=10;case 10:return[3,12];case 11:if(s)throw s.error;return[7];case 12:return[7];case 13:return[2]}})})}):null==e?m:new v(e,S(e))}function S(e){return null==e?"null":Array.isArray(e)?"array":e instanceof y?"path":e instanceof k?"datetime":typeof e}var j={datetime:1,number:2,string:3,boolean:4};function O(e,t){var r=S(e),n=S(t);if(r!==n)return null;switch(r){case"number":case"boolean":return e-t;case"string":if(e<t)return -1;if(e>t)return 1;return 0;case"datetime":return e.compareTo(t);default:return null}}function I(e,t){var r=S(e),n=S(t),a=j[r]||100,s=j[n]||100;if(a!==s)return a-s;var i=O(e,t);return null===i&&(i=0),i}var C=/([^!@#$%^&*(),\\/?";:{}|[\]+<>\s-])+/g,T=/([^!@#$%^&(),\\/?";:{}|[\]+<>\s-])+/g,M=/(\b\.+|\.+\b)/g;function P(e){return e.replace(M,"").match(C)||[]}function N(e){return(e.replace(M,"").match(T)||[]).map(function(e){return RegExp("^".concat(e.slice(0,1024).replace(/\*/g,".*"),"$"),"i")})}function U(e,t){var r,n,a,s;return i(this,void 0,void 0,function(){var i,o,c;return u(this,function(u){switch(u.label){case 0:if("string"===e.type)return t(e.data),[2,!0];if(!e.isArray())return[3,13];i=!0,u.label=1;case 1:u.trys.push([1,6,7,12]),r=l(e),u.label=2;case 2:return[4,r.next()];case 3:if((n=u.sent()).done)return[3,5];"string"===(o=n.value).type?t(o.data):i=!1,u.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return a={error:u.sent()},[3,12];case 7:if(u.trys.push([7,,10,11]),!(n&&!n.done&&(s=r.return)))return[3,9];return[4,s.call(r)];case 8:u.sent(),u.label=9;case 9:return[3,11];case 10:if(a)throw a.error;return[7];case 11:return[7];case 12:return[2,i];case 13:return[2,!1]}})})}function V(e){if("string"!=typeof e._type)return null;var t=e.children;if(!Array.isArray(t))return null;for(var r="",n=0;n<t.length;n++){var a=t[n];a&&"object"==typeof a&&"string"==typeof a._type&&"span"===a._type&&"string"==typeof a.text&&(r+=a.text)}return r}var D={};D.anywhere=function(){return i(this,void 0,void 0,function(){return u(this,function(e){throw Error("not implemented")})})},D.anywhere.arity=1,D.coalesce=function(e,t,r){return i(this,void 0,void 0,function(){var n,a,s,i;return u(this,function(s){switch(s.label){case 0:n=0,a=e,s.label=1;case 1:if(!(n<a.length))return[3,4];return[4,r(a[n],t)];case 2:if("null"!==(i=s.sent()).type)return[2,i];s.label=3;case 3:return n++,[3,1];case 4:return[2,m]}})})},D.count=function(e,t,r){var n,a;return i(this,void 0,void 0,function(){var s,i,o,c,f;return u(this,function(u){switch(u.label){case 0:return[4,r(e[0],t)];case 1:if(!(s=u.sent()).isArray())return[2,m];i=0,u.label=2;case 2:u.trys.push([2,7,8,13]),o=l(s),u.label=3;case 3:return[4,o.next()];case 4:if((c=u.sent()).done)return[3,6];c.value,i++,u.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return n={error:u.sent()},[3,13];case 8:if(u.trys.push([8,,11,12]),!(c&&!c.done&&(a=o.return)))return[3,10];return[4,a.call(o)];case 9:u.sent(),u.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:return[2,x(i)]}})})},D.count.arity=1,D.dateTime=function(e,t,r){return i(this,void 0,void 0,function(){var n;return u(this,function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:if("datetime"===(n=a.sent()).type)return[2,n];if("string"!==n.type)return[2,m];return[2,k.parseToValue(n.data)]}})})},D.dateTime.arity=1,D.defined=function(e,t,r){return i(this,void 0,void 0,function(){var n;return u(this,function(n){switch(n.label){case 0:return[4,r(e[0],t)];case 1:return[2,"null"===n.sent().type?g:w]}})})},D.defined.arity=1,D.identity=function(e,t){return i(this,void 0,void 0,function(){return u(this,function(e){return[2,_(t.context.identity)]})})},D.identity.arity=0,D.length=function(e,t,r){var n,a;return i(this,void 0,void 0,function(){var s,i,o,c,f;return u(this,function(u){switch(u.label){case 0:return[4,r(e[0],t)];case 1:if("string"===(s=u.sent()).type)return[2,x(function(e){for(var t=0,r=0;r<e.length;r++){var n=e.charCodeAt(r);(!(n>=55296)||!(n<=56319))&&t++}return t}(s.data))];if(!s.isArray())return[3,14];i=0,u.label=2;case 2:u.trys.push([2,7,8,13]),o=l(s),u.label=3;case 3:return[4,o.next()];case 4:if((c=u.sent()).done)return[3,6];c.value,i++,u.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return n={error:u.sent()},[3,13];case 8:if(u.trys.push([8,,11,12]),!(c&&!c.done&&(a=o.return)))return[3,10];return[4,a.call(o)];case 9:u.sent(),u.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:return[2,x(i)];case 14:return[2,m]}})})},D.length.arity=1,D.path=function(e,t,r){return i(this,void 0,void 0,function(){var n;return u(this,function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:var s;if("string"!==(n=a.sent()).type)return[2,m];return[2,(s=new y(n.data),new v(s,"path"))]}})})},D.path.arity=1,D.string=function(e,t,r){return i(this,void 0,void 0,function(){var n;return u(this,function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:switch((n=a.sent()).type){case"number":case"string":case"boolean":case"datetime":return[2,_("".concat(n.data))];default:return[2,m]}return[2]}})})},D.string.arity=1,D.references=function(e,t,r){var n,a;return i(this,void 0,void 0,function(){var s,i,o,c,f,p,h,d,y,b;return u(this,function(u){switch(u.label){case 0:s=new Set,i=0,o=e,u.label=1;case 1:if(!(i<o.length))return[3,16];return[4,r(o[i],t)];case 2:if("string"!==(f=u.sent()).type)return[3,3];return s.add(f.data),[3,15];case 3:if(!f.isArray())return[3,15];u.label=4;case 4:u.trys.push([4,9,10,15]),n=void 0,p=l(f),u.label=5;case 5:return[4,p.next()];case 6:if((h=u.sent()).done)return[3,8];"string"===(d=h.value).type&&s.add(d.data),u.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return n={error:u.sent()},[3,15];case 10:if(u.trys.push([10,,13,14]),!(h&&!h.done&&(a=p.return)))return[3,12];return[4,a.call(p)];case 11:u.sent(),u.label=12;case 12:return[3,14];case 13:if(n)throw n.error;return[7];case 14:return[7];case 15:return i++,[3,1];case 16:if(0===s.size)return[2,g];return[4,t.value.get()];case 17:return[2,!function e(t,r){switch(S(t)){case"array":for(var n=0;n<t.length;n++){var a=t[n];if(e(a,r))return!0}break;case"object":if(t._ref)return r.has(t._ref);for(var s=0,i=Object.values(t);s<i.length;s++){var a=i[s];if(e(a,r))return!0}}return!1}(u.sent(),s)?g:w]}})})},D.references.arity=function(e){return e>=1},D.round=function(e,t,r){return i(this,void 0,void 0,function(){var n,a,s,i;return u(this,function(u){switch(u.label){case 0:return[4,r(e[0],t)];case 1:if("number"!==(n=u.sent()).type)return[2,m];if(a=n.data,s=0,2!==e.length)return[3,3];return[4,r(e[1],t)];case 2:if("number"!==(i=u.sent()).type||i.data<0||!Number.isInteger(i.data))return[2,m];s=i.data,u.label=3;case 3:if(0===s){if(a<0)return[2,x(-Math.round(-a))];return[2,x(Math.round(a))]}return[2,x(Number(a.toFixed(s)))]}})})},D.round.arity=function(e){return e>=1&&e<=2},D.now=function(e,t){return i(this,void 0,void 0,function(){return u(this,function(e){return[2,_(t.context.timestamp.toISOString())]})})},D.now.arity=0,D.boost=function(){return i(this,void 0,void 0,function(){return u(this,function(e){throw Error("unexpected boost call")})})},D.boost.arity=2;var F={};F.lower=function(e,t,r){return i(this,void 0,void 0,function(){var n;return u(this,function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:if("string"!==(n=a.sent()).type)return[2,m];return[2,_(n.data.toLowerCase())]}})})},F.lower.arity=1,F.upper=function(e,t,r){return i(this,void 0,void 0,function(){var n;return u(this,function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:if("string"!==(n=a.sent()).type)return[2,m];return[2,_(n.data.toUpperCase())]}})})},F.upper.arity=1,F.split=function(e,t,r){return i(this,void 0,void 0,function(){var n,a;return u(this,function(s){switch(s.label){case 0:return[4,r(e[0],t)];case 1:if("string"!==(n=s.sent()).type)return[2,m];return[4,r(e[1],t)];case 2:if("string"!==(a=s.sent()).type)return[2,m];if(0===n.data.length)return[2,A([])];if(0===a.data.length)return[2,A(Array.from(n.data))];return[2,A(n.data.split(a.data))]}})})},F.split.arity=2,D.lower=F.lower,D.upper=F.upper,F.startsWith=function(e,t,r){return i(this,void 0,void 0,function(){var n,a;return u(this,function(s){switch(s.label){case 0:return[4,r(e[0],t)];case 1:if("string"!==(n=s.sent()).type)return[2,m];return[4,r(e[1],t)];case 2:if("string"!==(a=s.sent()).type)return[2,m];return[2,n.data.startsWith(a.data)?w:g]}})})},F.startsWith.arity=2;var q={};q.join=function(e,t,r){var n,a;return i(this,void 0,void 0,function(){var s,i,o,c,f,p,h,d;return u(this,function(u){switch(u.label){case 0:return[4,r(e[0],t)];case 1:if(!(s=u.sent()).isArray())return[2,m];return[4,r(e[1],t)];case 2:if("string"!==(i=u.sent()).type)return[2,m];o="",c=!1,u.label=3;case 3:u.trys.push([3,8,9,14]),f=l(s),u.label=4;case 4:return[4,f.next()];case 5:if((p=u.sent()).done)return[3,7];switch(h=p.value,c&&(o+=i.data),h.type){case"number":case"string":case"boolean":case"datetime":o+="".concat(h.data);break;default:return[2,m]}c=!0,u.label=6;case 6:return[3,4];case 7:return[3,14];case 8:return n={error:u.sent()},[3,14];case 9:if(u.trys.push([9,,12,13]),!(p&&!p.done&&(a=f.return)))return[3,11];return[4,a.call(f)];case 10:u.sent(),u.label=11;case 11:return[3,13];case 12:if(n)throw n.error;return[7];case 13:return[7];case 14:return[2,A(o)]}})})},q.join.arity=2,q.compact=function(e,t,r){return i(this,void 0,void 0,function(){var n;return u(this,function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:if(!(n=a.sent()).isArray())return[2,m];return[2,new b(function(){return c(this,arguments,function(){var e,t,r,a,s,i;return u(this,function(a){switch(a.label){case 0:a.trys.push([0,7,8,13]),e=l(n),a.label=1;case 1:return[4,o(e.next())];case 2:if((t=a.sent()).done)return[3,6];if(!("null"!==(r=t.value).type))return[3,5];return[4,o(r)];case 3:return[4,a.sent()];case 4:a.sent(),a.label=5;case 5:return[3,1];case 6:return[3,13];case 7:return s={error:a.sent()},[3,13];case 8:if(a.trys.push([8,,11,12]),!(t&&!t.done&&(i=e.return)))return[3,10];return[4,o(i.call(e))];case 9:a.sent(),a.label=10;case 10:return[3,12];case 11:if(s)throw s.error;return[7];case 12:return[7];case 13:return[2]}})})})]}})})},q.compact.arity=1,q.unique=function(e,t,r){return i(this,void 0,void 0,function(){var n;return u(this,function(a){switch(a.label){case 0:return[4,r(e[0],t)];case 1:if(!(n=a.sent()).isArray())return[2,m];return[2,new b(function(){return c(this,arguments,function(){var e,t,r,a,s,i,c,f;return u(this,function(i){switch(i.label){case 0:e=new Set,i.label=1;case 1:i.trys.push([1,13,14,19]),t=l(n),i.label=2;case 2:return[4,o(t.next())];case 3:if((r=i.sent()).done)return[3,12];switch(s=(a=r.value).type){case"number":case"string":case"boolean":case"datetime":return[3,4]}return[3,8];case 4:if(e.has(a.data))return[3,7];return e.add(a.data),[4,o(a)];case 5:return[4,i.sent()];case 6:i.sent(),i.label=7;case 7:return[3,11];case 8:return[4,o(a)];case 9:return[4,i.sent()];case 10:i.sent(),i.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return c={error:i.sent()},[3,19];case 14:if(i.trys.push([14,,17,18]),!(r&&!r.done&&(f=t.return)))return[3,16];return[4,o(f.call(t))];case 15:i.sent(),i.label=16;case 16:return[3,18];case 17:if(c)throw c.error;return[7];case 18:return[7];case 19:return[2]}})})})]}})})},q.unique.arity=1;var G={};G.text=function(e,t,r){return i(this,void 0,void 0,function(){var n,a;return u(this,function(n){switch(n.label){case 0:return[4,r(e[0],t)];case 1:return[4,function(e){return i(this,void 0,void 0,function(){var t;return u(this,function(r){switch(r.label){case 0:if("object"!==e.type)return[3,1];return[2,V(e.data)];case 1:if(!e.isArray())return[3,3];return[4,function e(t,r){var n,a,s,o;return void 0===r&&(r=[]),i(this,void 0,void 0,function(){var i,c,f;return u(this,function(u){switch(u.label){case 0:u.trys.push([0,7,8,13]),n=l(t),u.label=1;case 1:return[4,n.next()];case 2:if((a=u.sent()).done)return[3,6];if("object"!==(i=a.value).type)return[3,3];return null!==(c=V(i.data))&&r.push(c),[3,5];case 3:if(!i.isArray())return[3,5];return[4,e(i,r)];case 4:u.sent(),u.label=5;case 5:return[3,1];case 6:return[3,13];case 7:return s={error:u.sent()},[3,13];case 8:if(u.trys.push([8,,11,12]),!(a&&!a.done&&(o=n.return)))return[3,10];return[4,o.call(n)];case 9:u.sent(),u.label=10;case 10:return[3,12];case 11:if(s)throw s.error;return[7];case 12:return[7];case 13:return[2,r]}})})}(e)];case 2:if((t=r.sent()).length>0)return[2,t.join("\n\n")];r.label=3;case 3:return[2,null]}})})}(n.sent())];case 2:if(null===(a=n.sent()))return[2,m];return[2,_(a)]}})})},G.text.arity=1;var $={};$.projectId=function(e,t){return i(this,void 0,void 0,function(){return u(this,function(e){return t.context.sanity?[2,_(t.context.sanity.projectId)]:[2,m]})})},$.dataset=function(e,t){return i(this,void 0,void 0,function(){return u(this,function(e){return t.context.sanity?[2,_(t.context.sanity.dataset)]:[2,m]})})};var B={};B.order=function(e,t,r,n){var a,s,o,c;return i(this,void 0,void 0,function(){var i,f,p,h,d,y,b,v,w,g,k,x,_,E,S,j,O;return u(this,function(u){switch(u.label){case 0:return[4,!0];case 1:if(u.sent(),!e.isArray())return[2,m];for(h=0,i=[],f=[],p=0,d=t;h<d.length;h++)y=d[h],b="asc","Desc"===y.type?(b="desc",y=y.base):"Asc"===y.type&&(y=y.base),i.push(y),f.push(b),p++;v=[],w=0,u.label=2;case 2:u.trys.push([2,13,14,19]),a=l(e),u.label=3;case 3:return[4,a.next()];case 4:if((s=u.sent()).done)return[3,12];return g=s.value,k=r.createNested(g),[4,g.get()];case 5:x=[u.sent(),w],_=0,u.label=6;case 6:if(!(_<p))return[3,10];return[4,n(i[_],k)];case 7:return E=u.sent(),j=(S=x).push,[4,E.get()];case 8:j.apply(S,[u.sent()]),u.label=9;case 9:return _++,[3,6];case 10:v.push(x),w++,u.label=11;case 11:return[3,3];case 12:return[3,19];case 13:return o={error:u.sent()},[3,19];case 14:if(u.trys.push([14,,17,18]),!(s&&!s.done&&(c=a.return)))return[3,16];return[4,c.call(a)];case 15:u.sent(),u.label=16;case 16:return[3,18];case 17:if(o)throw o.error;return[7];case 18:return[7];case 19:return v.sort(function(e,t){for(var r=0;r<p;r++){var n=I(e[r+2],t[r+2]);if("desc"===f[r]&&(n=-n),0!==n)return n}return e[1]-t[1]}),[2,A(v.map(function(e){return e[0]}))]}})})},B.order.arity=function(e){return e>=1},B.score=function(e,t,r,n){var a,s,o,c;return i(this,void 0,void 0,function(){var f,p,h,d,y,b,v,w,g,k,x,_,E;return u(this,function(E){switch(E.label){case 0:if(!e.isArray())return[2,m];f=[],p=[],E.label=1;case 1:E.trys.push([1,12,13,18]),a=l(e),E.label=2;case 2:return[4,a.next()];case 3:if((s=E.sent()).done)return[3,11];if(!("object"!==(h=s.value).type))return[3,5];return y=(d=f).push,[4,h.get()];case 4:return y.apply(d,[E.sent()]),[3,10];case 5:b=r.createNested(h),v="number"==typeof h.data._score?h.data._score:0,w=0,g=t,E.label=6;case 6:if(!(w<g.length))return[3,9];return k=g[w],x=v,[4,function e(t,r,n){return i(this,void 0,void 0,function(){var a,s,o,c,l,f;return u(this,function(p){switch(p.label){case 0:if("OpCall"===t.type&&"match"===t.op)return[2,function(e,t,r,n){return i(this,void 0,void 0,function(){var a,s,i,o,c,l,f,p,h,d;return u(this,function(u){switch(u.label){case 0:return[4,n(e,r)];case 1:return a=u.sent(),[4,n(t,r)];case 2:return s=u.sent(),i=[],o=[],[4,U(a,function(e){i=i.concat(P(e))})];case 3:return u.sent(),[4,U(s,function(e){o=o.concat(N(e))})];case 4:if(!u.sent()||0===i.length||0===o.length)return[2,0];for(p=0,l=0,f=function(e){var t=i.reduce(function(t,r){return t+(e.test(r)?1:0)},0);l+=2.2*t/(t+1.2)},h=o;p<h.length;p++)f(h[p]);return[2,l]}})})}(t.left,t.right,r,n)];if(!("FuncCall"===t.type&&"boost"===t.name))return[3,3];return[4,e(t.args[0],r,n)];case 1:return a=p.sent(),[4,n(t.args[1],r)];case 2:if("number"===(s=p.sent()).type&&a>0)return[2,a+s.data];return[2,0];case 3:switch(o=t.type){case"Or":return[3,4];case"And":return[3,7]}return[3,10];case 4:case 7:return[4,e(t.left,r,n)];case 5:case 8:return c=p.sent(),[4,e(t.right,r,n)];case 6:return[2,c+(l=p.sent())];case 9:if(l=p.sent(),0===c||0===l)return[2,0];return[2,c+l];case 10:return[4,n(t,r)];case 11:return[2,"boolean"===(f=p.sent()).type&&!0===f.data?1:0]}})})}(k,b,n)];case 7:v=x+E.sent(),E.label=8;case 8:return w++,[3,6];case 9:_=Object.assign({},h.data,{_score:v}),p.push(_),E.label=10;case 10:return[3,2];case 11:return[3,18];case 12:return o={error:E.sent()},[3,18];case 13:if(E.trys.push([13,,16,17]),!(s&&!s.done&&(c=a.return)))return[3,15];return[4,c.call(a)];case 14:E.sent(),E.label=15;case 15:return[3,17];case 16:if(o)throw o.error;return[7];case 17:return[7];case 18:return p.sort(function(e,t){return t._score-e._score}),[2,A(p)]}})})},B.score.arity=function(e){return e>=1};var H={};H.operation=function(e,t){return i(this,void 0,void 0,function(){var e,r;return u(this,function(n){return(e=null!==t.context.before,r=null!==t.context.after,e&&r)?[2,_("update")]:r?[2,_("create")]:e?[2,_("delete")]:[2,m]})})},H.changedAny=function(){throw Error("not implemented")},H.changedAny.arity=1,H.changedAny.mode="delta",H.changedOnly=function(){throw Error("not implemented")},H.changedOnly.arity=1,H.changedOnly.mode="delta";var R={};R.changedAny=function(){throw Error("not implemented")},R.changedAny.arity=3,R.changedOnly=function(){throw Error("not implemented")},R.changedOnly.arity=3;var Z={};Z.min=function(e,t,r){var n,a;return i(this,void 0,void 0,function(){var s,i,o,c,f,p;return u(this,function(u){switch(u.label){case 0:return[4,r(e[0],t)];case 1:if(!(s=u.sent()).isArray())return[2,m];i=void 0,u.label=2;case 2:u.trys.push([2,7,8,13]),o=l(s),u.label=3;case 3:return[4,o.next()];case 4:if((c=u.sent()).done)return[3,6];if("null"===(f=c.value).type)return[3,5];if("number"!==f.type)return[2,m];(void 0===i||f.data<i)&&(i=f.data),u.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return n={error:u.sent()},[3,13];case 8:if(u.trys.push([8,,11,12]),!(c&&!c.done&&(a=o.return)))return[3,10];return[4,a.call(o)];case 9:u.sent(),u.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:return[2,A(i)]}})})},Z.min.arity=1,Z.max=function(e,t,r){var n,a;return i(this,void 0,void 0,function(){var s,i,o,c,f,p;return u(this,function(u){switch(u.label){case 0:return[4,r(e[0],t)];case 1:if(!(s=u.sent()).isArray())return[2,m];i=void 0,u.label=2;case 2:u.trys.push([2,7,8,13]),o=l(s),u.label=3;case 3:return[4,o.next()];case 4:if((c=u.sent()).done)return[3,6];if("null"===(f=c.value).type)return[3,5];if("number"!==f.type)return[2,m];(void 0===i||f.data>i)&&(i=f.data),u.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return n={error:u.sent()},[3,13];case 8:if(u.trys.push([8,,11,12]),!(c&&!c.done&&(a=o.return)))return[3,10];return[4,a.call(o)];case 9:u.sent(),u.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:return[2,A(i)]}})})},Z.max.arity=1,Z.sum=function(e,t,r){var n,a;return i(this,void 0,void 0,function(){var s,i,o,c,f,p;return u(this,function(u){switch(u.label){case 0:return[4,r(e[0],t)];case 1:if(!(s=u.sent()).isArray())return[2,m];i=0,u.label=2;case 2:u.trys.push([2,7,8,13]),o=l(s),u.label=3;case 3:return[4,o.next()];case 4:if((c=u.sent()).done)return[3,6];if("null"===(f=c.value).type)return[3,5];if("number"!==f.type)return[2,m];i+=f.data,u.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return n={error:u.sent()},[3,13];case 8:if(u.trys.push([8,,11,12]),!(c&&!c.done&&(a=o.return)))return[3,10];return[4,a.call(o)];case 9:u.sent(),u.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:return[2,A(i)]}})})},Z.sum.arity=1,Z.avg=function(e,t,r){var n,a;return i(this,void 0,void 0,function(){var s,i,o,c,f,p,h;return u(this,function(u){switch(u.label){case 0:return[4,r(e[0],t)];case 1:if(!(s=u.sent()).isArray())return[2,m];i=0,o=0,u.label=2;case 2:u.trys.push([2,7,8,13]),c=l(s),u.label=3;case 3:return[4,c.next()];case 4:if((f=u.sent()).done)return[3,6];if("null"===(p=f.value).type)return[3,5];if("number"!==p.type)return[2,m];i+=p.data,o++,u.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return n={error:u.sent()},[3,13];case 8:if(u.trys.push([8,,11,12]),!(f&&!f.done&&(a=c.return)))return[3,10];return[4,a.call(c)];case 9:u.sent(),u.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:if(0===o)return[2,m];return[2,A(i/o)]}})})},Z.avg.arity=1;var z={global:D,string:F,array:q,pt:G,delta:H,diff:R,sanity:$,math:Z};let Q=/^([\t\n\v\f\r \u0085\u00A0]|(\/\/[^\n]*\n))+/,W=/^\d+/,J=/^[a-zA-Z_][a-zA-Z_0-9]*/;function L(e,t,r){let n=t,a=e[t],s;switch(a){case"+":{let i=L(e,ee(e,t+1),10);if("error"===i.type)return i;s=[{name:"pos",position:n}].concat(i.marks),t=i.position;break}case"-":{let u=L(e,ee(e,t+1),8);if("error"===u.type)return u;s=[{name:"neg",position:n}].concat(u.marks),t=u.position;break}case"(":{let o=L(e,ee(e,t+1),0);if("error"===o.type)return o;switch(e[t=ee(e,o.position)]){case",":for(s=[{name:"tuple",position:n}].concat(o.marks),t=ee(e,t+1);;){if("error"===(o=L(e,t,0)).type)return o;if(","!==e[t=ee(e,o.position)])break;t=ee(e,t+1)}if(")"!==e[t])return{type:"error",position:t};t++,s.push({name:"tuple_end",position:t});break;case")":t++,s=[{name:"group",position:n}].concat(o.marks);break;default:return{type:"error",position:t}}break}case"!":{let c=L(e,ee(e,t+1),10);if("error"===c.type)return c;s=[{name:"not",position:n}].concat(c.marks),t=c.position;break}case"{":{let l=X(e,t);if("error"===l.type)return l;s=l.marks,t=l.position;break}case"[":if(s=[{name:"array",position:t}],"]"!==e[t=ee(e,t+1)])for(;;){"..."===e.slice(t,t+3)&&(s.push({name:"array_splat",position:t}),t=ee(e,t+3));let f=L(e,t,0);if("error"===f.type)return f;if(s=s.concat(f.marks),","!==e[t=ee(e,t=f.position)]||"]"===e[t=ee(e,t+1)])break}if("]"!==e[t])return{type:"error",position:t};t++,s.push({name:"array_end",position:t});break;case"'":case'"':{let p=function e(t,r){let n=t[r];r+=1;let a=[{name:"str",position:r}];str:for(;;r++){if(r>t.length)return{type:"error",position:r};switch(t[r]){case n:a.push({name:"str_end",position:r}),r++;break str;case"\\":a.push({name:"str_pause",position:r}),"u"===t[r+1]?"{"===t[r+2]?(a.push({name:"unicode_hex",position:r+3}),r=t.indexOf("}",r+3),a.push({name:"unicode_hex_end",position:r})):(a.push({name:"unicode_hex",position:r+2}),a.push({name:"unicode_hex_end",position:r+6}),r+=5):(a.push({name:"single_escape",position:r+1}),r+=1),a.push({name:"str_start",position:r+1})}}return{type:"success",marks:a,position:r}}(e,t);if("error"===p.type)return p;s=p.marks,t=p.position;break}case"^":for(t++,s=[];"."===e[t]&&"^"===e[t+1];)s.push({name:"dblparent",position:n}),t+=2;s.push({name:"parent",position:n});break;case"@":s=[{name:"this",position:n}],t++;break;case"*":s=[{name:"everything",position:n}],t++;break;case"$":{let h=et(e,t+1,J);h&&(t+=1+h,s=[{name:"param",position:n},{name:"ident",position:n+1},{name:"ident_end",position:t},]);break}default:{let d=et(e,t,W);if(d){let y="integer";if("."===e[t+=d]){let b=et(e,t+1,W);b&&(y="float",t+=1+b)}if("e"===e[t]||"E"===e[t]){y="sci",("+"===e[++t]||"-"===e[t])&&t++;let v=et(e,t,W);if(!v)return{type:"error",position:t};t+=v}s=[{name:y,position:n},{name:y+"_end",position:t},];break}let m=et(e,t,J);if(m)switch(e[t+=m]){case":":case"(":{let w=K(e,n,t);if("error"===w.type)return w;s=w.marks,t=w.position;break}default:s=[{name:"this_attr",position:n},{name:"ident",position:n},{name:"ident_end",position:t},]}}}if(!s)return{type:"error",position:t};let g=12,k;loop:for(;;){let x=ee(e,t);if(x===e.length){t=x;break}if("success"===(k=Y(e,x)).type){for(s.unshift({name:"traverse",position:n});"success"===k.type;)s=s.concat(k.marks),k=Y(e,ee(e,t=k.position));s.push({name:"traversal_end",position:t});continue}let _=e[x];switch(_){case"=":{let E=e[x+1];switch(E){case">":{if(r>1||g<=1)break loop;let A=L(e,ee(e,x+2),1);if("error"===A.type)return A;(s=s.concat(A.marks)).unshift({name:"pair",position:n}),t=A.position,g=1;break}case"=":{if(r>4||g<=4)break loop;let S=L(e,ee(e,x+2),5);if("error"===S.type)return S;s.unshift({name:"comp",position:n}),s.push({name:"op",position:x},{name:"op_end",position:x+2}),s=s.concat(S.marks),t=S.position,g=4;break}default:break loop}break}case"+":{if(r>6||g<6)break loop;let j=L(e,ee(e,x+1),7);if("error"===j.type)return j;(s=s.concat(j.marks)).unshift({name:"add",position:n}),t=j.position,g=6;break}case"-":{if(r>6||g<6)break loop;let O=L(e,ee(e,x+1),7);if("error"===O.type)return O;(s=s.concat(O.marks)).unshift({name:"sub",position:n}),t=O.position,g=6;break}case"*":{if("*"===e[x+1]){if(r>8||g<=8)break loop;let I=L(e,ee(e,x+2),8);if("error"===I.type)return I;(s=s.concat(I.marks)).unshift({name:"pow",position:n}),t=I.position,g=8;break}if(r>7||g<7)break loop;let C=L(e,ee(e,x+1),8);if("error"===C.type)return C;(s=s.concat(C.marks)).unshift({name:"mul",position:n}),t=C.position,g=7;break}case"/":{if(r>7||g<7)break loop;let T=L(e,ee(e,x+1),8);if("error"===T.type)return T;(s=s.concat(T.marks)).unshift({name:"div",position:n}),t=T.position,g=7;break}case"%":{if(r>7||g<7)break loop;let M=L(e,ee(e,x+1),8);if("error"===M.type)return M;(s=s.concat(M.marks)).unshift({name:"mod",position:n}),t=M.position,g=7;break}case"<":case">":{if(r>4||g<=4)break loop;let P=x+1;"="===e[P]&&P++;let N=L(e,ee(e,P),5);if("error"===N.type)return N;s.unshift({name:"comp",position:n}),s.push({name:"op",position:x},{name:"op_end",position:P}),s=s.concat(N.marks),t=N.position,g=4;break}case"|":if("|"===e[x+1]){if(r>2||g<2)break loop;let U=L(e,ee(e,x+2),3);if("error"===U.type)return U;(s=s.concat(U.marks)).unshift({name:"or",position:n}),t=U.position,g=2}else{if(r>11||g<11)break loop;let V=ee(e,x+1),D=et(e,V,J);if(!D)return{type:"error",position:V};if("("===e[t=V+D]||":"===e[t]){let F=K(e,V,t);if("error"===F.type)return F;(s=s.concat(F.marks)).unshift({name:"pipecall",position:n}),t=F.position,g=11}}break;case"&":{if("&"!=e[x+1]||r>3||g<3)break loop;let q=L(e,ee(e,x+2),4);if("error"===q.type)return q;(s=s.concat(q.marks)).unshift({name:"and",position:n}),t=q.position,g=3;break}case"!":{if("="!==e[x+1]||r>4||g<4)break loop;let G=L(e,ee(e,x+2),5);if("error"===G.type)return G;s.unshift({name:"comp",position:n}),s.push({name:"op",position:x},{name:"op_end",position:x+2}),s=s.concat(G.marks),t=G.position,g=4;break}case"d":if("desc"!==e.slice(x,x+4)||r>4||g<4)break loop;s.unshift({name:"desc",position:n}),t=x+4,g=4;break;case"a":if("asc"!==e.slice(x,x+3)||r>4||g<4)break loop;s.unshift({name:"asc",position:n}),t=x+3,g=4;break;default:{let $=er(e,x,J);switch($){case"in":{if(r>4||g<=4)break loop;t=ee(e,x+2);let B=!1;"("===e[t]&&(B=!0,t=ee(e,t+1));let H=t,R=L(e,t,5);if("error"===R.type)return R;if("."===e[t=ee(e,R.position)]&&"."===e[t+1]){let Z="inc_range";"."===e[t+2]?(Z="exc_range",t=ee(e,t+3)):t=ee(e,t+2);let z=L(e,t,5);if("error"===z.type)return z;s.unshift({name:"in_range",position:n}),s=s.concat({name:Z,position:H},R.marks,z.marks),t=z.position}else s.unshift({name:"comp",position:n}),s.push({name:"op",position:x},{name:"op_end",position:x+2}),s=s.concat(R.marks);if(B){if(")"!==e[t=ee(e,t)])return{type:"error",position:t};t++}g=4;break}case"match":{if(r>4||g<=4)break loop;let Q=L(e,ee(e,x+5),5);if("error"===Q.type)return Q;s.unshift({name:"comp",position:n}),s.push({name:"op",position:x},{name:"op_end",position:x+5}),s=s.concat(Q.marks),t=Q.position,g=4;break}default:break loop}}}}let en=k?.type==="error"&&k.position;return{type:"success",marks:s,position:t,failPosition:en}}function Y(e,t){let r=t;switch(e[t]){case".":{let n=t=ee(e,t+1),a=et(e,t,J);if(!a)return{type:"error",position:t};return{type:"success",marks:[{name:"attr_access",position:r},{name:"ident",position:n},{name:"ident_end",position:t+=a},],position:t}}case"-":if(">"!==e[t+1])break;let s=[{name:"deref",position:r}],i=ee(e,t+=2),u=et(e,i,J);return u&&(t=i+u,s.push({name:"deref_attr",position:i},{name:"ident",position:i},{name:"ident_end",position:t})),{type:"success",marks:s,position:t};case"[":{if("]"===e[t=ee(e,t+1)])return{type:"success",marks:[{name:"array_postfix",position:r}],position:t+1};let o=t,c=L(e,t,0);if("error"===c.type)return c;if("."===e[t=ee(e,c.position)]&&"."===e[t+1]){let l="inc_range";"."===e[t+2]?(l="exc_range",t+=3):t+=2,t=ee(e,t);let f=L(e,t,0);if("error"===f.type)return f;if("]"!==e[t=ee(e,f.position)])return{type:"error",position:t};return{type:"success",marks:[{name:"slice",position:r},{name:l,position:o},].concat(c.marks,f.marks),position:t+1}}if("]"!==e[t])return{type:"error",position:t};return{type:"success",marks:[{name:"square_bracket",position:r}].concat(c.marks),position:t+1}}case"|":if("{"===e[t=ee(e,t+1)]){let p=X(e,t);if("error"===p.type)return p;return p.marks.unshift({name:"projection",position:r}),p}break;case"{":{let h=X(e,t);if("error"===h.type)return h;return h.marks.unshift({name:"projection",position:r}),h}}return{type:"error",position:t}}function K(e,t,r){let n=[];if(n.push({name:"func_call",position:t}),":"===e[r]&&":"===e[r+1]){n.push({name:"namespace",position:t}),n.push({name:"ident",position:t},{name:"ident_end",position:r}),r=ee(e,r+2);let a=et(e,r,J);if(!a||(n.push({name:"ident",position:r},{name:"ident_end",position:r+a}),"("!==e[r=ee(e,r+a)]))return{type:"error",position:r};r++}else n.push({name:"ident",position:t},{name:"ident_end",position:r}),r=ee(e,r+1);let s=r;if(")"!==e[r])for(;;){let i=L(e,r,0);if("error"===i.type)return i;if(n=n.concat(i.marks),s=i.position,","!==e[r=ee(e,i.position)]||")"===e[r=ee(e,r+1)])break}return")"!==e[r]?{type:"error",position:r}:(n.push({name:"func_args_end",position:s}),{type:"success",marks:n,position:r+1})}function X(e,t){let r=[{name:"object",position:t}];for(t=ee(e,t+1);"}"!==e[t];){let n=t;if("..."===e.slice(t,t+3)){if("}"!==e[t=ee(e,t+3)]&&","!==e[t]){let a=L(e,t,0);if("error"===a.type)return a;r.push({name:"object_splat",position:n}),r=r.concat(a.marks),t=a.position}else r.push({name:"object_splat_this",position:n})}else{let s=L(e,t,0);if("error"===s.type)return s;let i=ee(e,s.position);if("str"===s.marks[0].name&&":"===e[i]){let u=L(e,ee(e,i+1),0);if("error"===u.type)return u;r.push({name:"object_pair",position:n}),r=r.concat(s.marks,u.marks),t=u.position}else r=r.concat({name:"object_expr",position:t},s.marks),t=s.position}if(","!==e[t=ee(e,t)])break;t=ee(e,t+1)}return"}"!==e[t]?{type:"error",position:t}:(t++,r.push({name:"object_end",position:t}),{type:"success",marks:r,position:t})}function ee(e,t){return t+et(e,t,Q)}function et(e,t,r){let n=r.exec(e.slice(t));return n?n[0].length:0}function er(e,t,r){let n=r.exec(e.slice(t));return n?n[0]:null}function en(e,t){return function(r){return t(e(r))}}function ea(e){return function(t){return{type:"Map",base:t,expr:e({type:"This"})}}}function es(e,t){if(!t)return{type:"a-a",build:e};switch(t.type){case"a-a":return{type:"a-a",build:en(e,t.build)};case"a-b":return{type:"a-b",build:en(e,t.build)};case"b-b":return{type:"a-a",build:en(e,ea(t.build))};case"b-a":var r;return{type:"a-a",build:en(e,(r=t.build,function(e){return{type:"FlatMap",base:e,expr:r({type:"This"})}}))};default:throw Error("unknown type: ".concat(t.type))}}function ei(e,t){if(!t)return{type:"b-b",build:e};switch(t.type){case"a-a":case"b-a":return{type:"b-a",build:en(e,t.build)};case"a-b":case"b-b":return{type:"b-b",build:en(e,t.build)};default:throw Error("unknown type: ".concat(t.type))}}var eu={"==":function(e,t){var r,n;return(r=e,n=t,"string"===r.type&&"string"===n.type||"boolean"===r.type&&"boolean"===n.type||"null"===r.type&&"null"===n.type||"number"===r.type&&"number"===n.type?r.data===n.data:"datetime"===r.type&&"datetime"===n.type&&r.data.equals(n.data))?w:g},"!=":function(e,t){return equality(e,t)?g:w},">":function(e,t){if("stream"===e.type||"stream"===t.type)return m;var r=O(e.data,t.data);return null===r?m:r>0?w:g},">=":function(e,t){if("stream"===e.type||"stream"===t.type)return m;var r=O(e.data,t.data);return null===r?m:r>=0?w:g},"<":function(e,t){if("stream"===e.type||"stream"===t.type)return m;var r=O(e.data,t.data);return null===r?m:r<0?w:g},"<=":function(e,t){if("stream"===e.type||"stream"===t.type)return m;var r=O(e.data,t.data);return null===r?m:r<=0?w:g},in:function(e,t){var r,n,a,s;return i(this,void 0,void 0,function(){var i,o;return u(this,function(i){switch(i.label){case 0:if("path"===t.type){if("string"!==e.type)return[2,m];return[2,t.data.matches(e.data)?w:g]}if(!t.isArray())return[3,13];i.label=1;case 1:i.trys.push([1,6,7,12]),r=l(t),i.label=2;case 2:return[4,r.next()];case 3:if((n=i.sent()).done)return[3,5];if(equality(e,n.value))return[2,w];i.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return a={error:i.sent()},[3,12];case 7:if(i.trys.push([7,,10,11]),!(n&&!n.done&&(s=r.return)))return[3,9];return[4,s.call(r)];case 8:i.sent(),i.label=9;case 9:return[3,11];case 10:if(a)throw a.error;return[7];case 11:return[7];case 12:return[2,g];case 13:return[2,m]}})})},match:function(e,t){return i(this,void 0,void 0,function(){var r,n,a,s;return u(this,function(a){switch(a.label){case 0:return r=[],n=[],[4,U(e,function(e){r=r.concat(P(e))})];case 1:return a.sent(),[4,U(t,function(e){var t;n=n.concat(N(e).map(function(e){return function(t){return t.some(function(t){return e.test(t)})}}))})];case 2:var s,i;if(!a.sent())return[2,g];return s=r,i=n,[2,0!==s.length&&0!==i.length&&i.every(function(e){return e(s)})?w:g]}})})},"+":function(e,t){return"datetime"===e.type&&"number"===t.type?E(e.data.add(t.data)):"number"===e.type&&"number"===t.type?x(e.data+t.data):"string"===e.type&&"string"===t.type?_(e.data+t.data):"object"===e.type&&"object"===t.type?A(s(s({},e.data),t.data)):"array"===e.type&&"array"===t.type?A(e.data.concat(t.data)):e.isArray()&&t.isArray()?new b(function(){return c(this,arguments,function(){var r,n,a,s,i,c,f,p,h,d,y;return u(this,function(a){switch(a.label){case 0:a.trys.push([0,7,8,13]),r=l(e),a.label=1;case 1:return[4,o(r.next())];case 2:if((n=a.sent()).done)return[3,6];return[4,o(n.value)];case 3:return[4,a.sent()];case 4:a.sent(),a.label=5;case 5:return[3,1];case 6:return[3,13];case 7:return p={error:a.sent()},[3,13];case 8:if(a.trys.push([8,,11,12]),!(n&&!n.done&&(h=r.return)))return[3,10];return[4,o(h.call(r))];case 9:a.sent(),a.label=10;case 10:return[3,12];case 11:if(p)throw p.error;return[7];case 12:return[7];case 13:a.trys.push([13,20,21,26]),i=l(t),a.label=14;case 14:return[4,o(i.next())];case 15:if((c=a.sent()).done)return[3,19];return[4,o(c.value)];case 16:return[4,a.sent()];case 17:a.sent(),a.label=18;case 18:return[3,14];case 19:return[3,26];case 20:return d={error:a.sent()},[3,26];case 21:if(a.trys.push([21,,24,25]),!(c&&!c.done&&(y=i.return)))return[3,23];return[4,o(y.call(i))];case 22:a.sent(),a.label=23;case 23:return[3,25];case 24:if(d)throw d.error;return[7];case 25:return[7];case 26:return[2]}})})}):m},"-":function(e,t){return"datetime"===e.type&&"number"===t.type?E(e.data.add(-t.data)):"datetime"===e.type&&"datetime"===t.type?x(e.data.difference(t.data)):"number"===e.type&&"number"===t.type?x(e.data-t.data):m},"*":eo(function(e,t){return e*t}),"/":eo(function(e,t){return e/t}),"%":eo(function(e,t){return e%t}),"**":eo(function(e,t){return Math.pow(e,t)})};function eo(e){return function(t,r){return"number"===t.type&&"number"===r.type?x(e(t.data,r.data)):m}}var ec=function(){function e(e,t,r,n,a){this.isHidden=!1,this.params=e,this.source=t,this.value=r,this.context=n,this.parent=a}return e.prototype.createNested=function(t){return this.isHidden?new e(this.params,this.source,t,this.context,this.parent):new e(this.params,this.source,t,this.context,this)},e.prototype.createHidden=function(e){var t=this.createNested(e);return t.isHidden=!0,t},e}();function el(e,t,r){return void 0===r&&(r=el),(0,ep[e.type])(e,t,r)}function ef(e,t){return"then"in e?e.then(t):t(e)}var ep={This:function(e,t){return t.value},Selector:function(){throw Error("Selectors can not be evaluated")},Everything:function(e,t){return t.source},Parameter:function(e,t){var r=e.name;return A(t.params[r])},Context:function(e,t){var r=e.key;if("before"===r||"after"===r)return t.context[r]||m;throw Error("unknown context key: ".concat(r))},Parent:function(e,t){for(var r=e.n,n=t,a=0;a<r;a++){if(!n.parent)return m;n=n.parent}return n.value},OpCall:function(e,t,r){var n=e.op,a=e.left,s=e.right,o=eu[n];if(!o)throw Error("Unknown operator: ".concat(n));var c=r(a,t),l=r(s,t);return"then"in c||"then"in l?i(this,void 0,void 0,function(){var e,t;return u(this,function(r){switch(r.label){case 0:return e=o,[4,c];case 1:return t=[r.sent()],[4,l];case 2:return[2,e.apply(void 0,t.concat([r.sent()]))]}})}):o(c,l)},Select:function(e,t,r){var n=e.alternatives,a=e.fallback;return i(this,void 0,void 0,function(){var e,s,i,o;return u(this,function(u){switch(u.label){case 0:e=0,s=n,u.label=1;case 1:if(!(e<s.length))return[3,4];return[4,r((i=s[e]).condition,t)];case 2:if("boolean"===(o=u.sent()).type&&!0===o.data)return[2,r(i.value,t)];u.label=3;case 3:return e++,[3,1];case 4:if(a)return[2,r(a,t)];return[2,m]}})})},InRange:function(e,t,r){var n=e.base,a=e.left,s=e.right,o=e.isInclusive;return i(this,void 0,void 0,function(){var e,i,c,l,f,p,h,d,y;return u(this,function(u){switch(u.label){case 0:return[4,r(n,t)];case 1:return e=u.sent(),[4,r(a,t)];case 2:return i=u.sent(),[4,r(s,t)];case 3:return c=u.sent(),f=O,[4,e.get()];case 4:return p=[u.sent()],[4,i.get()];case 5:if(null===(l=f.apply(void 0,p.concat([u.sent()]))))return[2,m];return d=O,[4,e.get()];case 6:return y=[u.sent()],[4,c.get()];case 7:if(null===(h=d.apply(void 0,y.concat([u.sent()]))))return[2,m];if(o)return[2,l>=0&&h<=0?w:g];return[2,l>=0&&h<0?w:g]}})})},Filter:function(e,t,r){var n=e.base,a=e.expr;return i(this,void 0,void 0,function(){var e;return u(this,function(s){switch(s.label){case 0:return[4,r(n,t)];case 1:if(!(e=s.sent()).isArray())return[2,m];return[2,new b(function(){return c(this,arguments,function(){var n,s,i,c,f,p,h,d;return u(this,function(u){switch(u.label){case 0:u.trys.push([0,8,9,14]),n=l(e),u.label=1;case 1:return[4,o(n.next())];case 2:if((s=u.sent()).done)return[3,7];return i=s.value,[4,o(r(a,t.createNested(i)))];case 3:if(!("boolean"===(f=u.sent()).type&&!0===f.data))return[3,6];return[4,o(i)];case 4:return[4,u.sent()];case 5:u.sent(),u.label=6;case 6:return[3,1];case 7:return[3,14];case 8:return h={error:u.sent()},[3,14];case 9:if(u.trys.push([9,,12,13]),!(s&&!s.done&&(d=n.return)))return[3,11];return[4,o(d.call(n))];case 10:u.sent(),u.label=11;case 11:return[3,13];case 12:if(h)throw h.error;return[7];case 13:return[7];case 14:return[2]}})})})]}})})},Projection:function(e,t,r){var n=e.base,a=e.expr;return i(this,void 0,void 0,function(){var e,s;return u(this,function(s){switch(s.label){case 0:return[4,r(n,t)];case 1:if("object"!==(e=s.sent()).type)return[2,m];return[2,r(a,t.createNested(e))]}})})},FuncCall:function(e,t,r){var n;return(0,e.func)(e.args,t,r)},PipeFuncCall:function(e,t,r){var n=e.func,a=e.base,s=e.args;return i(this,void 0,void 0,function(){var e;return u(this,function(e){switch(e.label){case 0:return[4,r(a,t)];case 1:return[2,n(e.sent(),s,t,r)]}})})},AccessAttribute:function(e,t,r){var n=e.base,a=e.name;return i(this,void 0,void 0,function(){var e;return u(this,function(s){switch(s.label){case 0:if(e=t.value,!n)return[3,2];return[4,r(n,t)];case 1:e=s.sent(),s.label=2;case 2:if("object"===e.type&&e.data.hasOwnProperty(a))return[2,A(e.data[a])];return[2,m]}})})},AccessElement:function(e,t,r){var n=e.base,a=e.index;return i(this,void 0,void 0,function(){var e,s,i;return u(this,function(i){switch(i.label){case 0:return[4,r(n,t)];case 1:if(!(e=i.sent()).isArray())return[2,m];return[4,e.get()];case 2:return[2,A((s=i.sent())[a<0?a+s.length:a])]}})})},Slice:function(e,t,r){var n=e.base,a=e.left,s=e.right,o=e.isInclusive;return i(this,void 0,void 0,function(){var e,i,c,l;return u(this,function(u){switch(u.label){case 0:return[4,r(n,t)];case 1:if(!(e=u.sent()).isArray())return[2,m];return[4,e.get()];case 2:return i=u.sent(),c=a,l=s,c<0&&(c=i.length+c),l<0&&(l=i.length+l),o&&l++,c<0&&(c=0),l<0&&(l=0),[2,A(i.slice(c,l))]}})})},Deref:function(e,t,r){var n,a,s=e.base;return i(this,void 0,void 0,function(){var e,i,o,c,f,p;return u(this,function(u){switch(u.label){case 0:return[4,r(s,t)];case 1:if(e=u.sent(),!t.source.isArray()||"object"!==e.type||"string"!=typeof(i=e.data._ref))return[2,m];u.label=2;case 2:u.trys.push([2,7,8,13]),o=l(t.source),u.label=3;case 3:return[4,o.next()];case 4:if((c=u.sent()).done)return[3,6];if("object"===(f=c.value).type&&i===f.data._id)return[2,f];u.label=5;case 5:return[3,3];case 6:return[3,13];case 7:return n={error:u.sent()},[3,13];case 8:if(u.trys.push([8,,11,12]),!(c&&!c.done&&(a=o.return)))return[3,10];return[4,a.call(o)];case 9:u.sent(),u.label=10;case 10:return[3,12];case 11:if(n)throw n.error;return[7];case 12:return[7];case 13:return[2,m]}})})},Value:function(e){return A(e.value)},Group:function(e,t,r){return r(e.base,t)},Object:function(e,t,r){var n=e.attributes;return i(this,void 0,void 0,function(){var e,a,s,i,o,c,l,f,p,h;return u(this,function(u){switch(u.label){case 0:e={},a=0,s=n,u.label=1;case 1:if(!(a<s.length))return[3,12];switch(o=(i=s[a]).type,c=i.type){case"ObjectAttributeValue":return[3,2];case"ObjectConditionalSplat":return[3,5];case"ObjectSplat":return[3,8]}return[3,10];case 2:case 8:return[4,r(i.value,t)];case 3:return l=u.sent(),f=e,p=i.name,[4,l.get()];case 4:return f[p]=u.sent(),[3,11];case 5:return[4,r(i.condition,t)];case 6:if("boolean"!==(h=u.sent()).type||!1===h.data)return[3,11];return[4,r(i.value,t)];case 7:case 9:return"object"===(l=u.sent()).type&&Object.assign(e,l.data),[3,11];case 10:throw Error("Unknown node type: ".concat(o));case 11:return a++,[3,1];case 12:return[2,A(e)]}})})},Array:function(e,t,r){var n=e.elements;return new b(function(){return c(this,arguments,function(){var e,a,s,i,c,f,p,h,d,y;return u(this,function(u){switch(u.label){case 0:e=0,a=n,u.label=1;case 1:if(!(e<a.length))return[3,21];return[4,o(r((s=a[e]).value,t))];case 2:if(i=u.sent(),!s.isSplat)return[3,17];if(!i.isArray())return[3,16];u.label=3;case 3:u.trys.push([3,10,11,16]),d=void 0,c=l(i),u.label=4;case 4:return[4,o(c.next())];case 5:if((f=u.sent()).done)return[3,9];return[4,o(f.value)];case 6:return[4,u.sent()];case 7:u.sent(),u.label=8;case 8:return[3,4];case 9:return[3,16];case 10:return d={error:u.sent()},[3,16];case 11:if(u.trys.push([11,,14,15]),!(f&&!f.done&&(y=c.return)))return[3,13];return[4,o(y.call(c))];case 12:u.sent(),u.label=13;case 13:return[3,15];case 14:if(d)throw d.error;return[7];case 15:return[7];case 16:return[3,20];case 17:return[4,o(i)];case 18:return[4,u.sent()];case 19:u.sent(),u.label=20;case 20:return e++,[3,1];case 21:return[2]}})})})},Tuple:function(){throw Error("tuples can not be evaluated")},Or:function(e,t,r){var n=e.left,a=e.right;return i(this,void 0,void 0,function(){var e,s;return u(this,function(i){switch(i.label){case 0:return[4,r(n,t)];case 1:return e=i.sent(),[4,r(a,t)];case 2:if(s=i.sent(),"boolean"===e.type&&!0===e.data||"boolean"===s.type&&!0===s.data)return[2,w];if("boolean"!==e.type||"boolean"!==s.type)return[2,m];return[2,g]}})})},And:function(e,t,r){var n=e.left,a=e.right;return i(this,void 0,void 0,function(){var e,s;return u(this,function(i){switch(i.label){case 0:return[4,r(n,t)];case 1:return e=i.sent(),[4,r(a,t)];case 2:if(s=i.sent(),"boolean"===e.type&&!1===e.data||"boolean"===s.type&&!1===s.data)return[2,g];if("boolean"!==e.type||"boolean"!==s.type)return[2,m];return[2,w]}})})},Not:function(e,t,r){var n=e.base;return i(this,void 0,void 0,function(){var e;return u(this,function(a){switch(a.label){case 0:return[4,r(n,t)];case 1:if("boolean"!==(e=a.sent()).type)return[2,m];return[2,e.data?g:w]}})})},Neg:function(e,t,r){return ef(r(e.base,t),function(e){return"number"!==e.type?m:x(-e.data)})},Pos:function(e,t,r){return ef(r(e.base,t),function(e){return"number"!==e.type?m:x(e.data)})},Asc:function(){return m},Desc:function(){return m},ArrayCoerce:function(e,t,r){var n=e.base;return i(this,void 0,void 0,function(){var e;return u(this,function(a){switch(a.label){case 0:return[4,r(n,t)];case 1:return[2,(e=a.sent()).isArray()?e:m]}})})},Map:function(e,t,r){var n=e.base,a=e.expr;return i(this,void 0,void 0,function(){var e;return u(this,function(s){switch(s.label){case 0:return[4,r(n,t)];case 1:if(!(e=s.sent()).isArray())return[2,m];return[2,new b(function(){return c(this,arguments,function(){var n,s,i,c,f,p,h;return u(this,function(u){switch(u.label){case 0:u.trys.push([0,8,9,14]),n=l(e),u.label=1;case 1:return[4,o(n.next())];case 2:if((s=u.sent()).done)return[3,7];return i=s.value,[4,o(r(a,t.createHidden(i)))];case 3:return[4,o.apply(void 0,[u.sent()])];case 4:return[4,u.sent()];case 5:u.sent(),u.label=6;case 6:return[3,1];case 7:return[3,14];case 8:return p={error:u.sent()},[3,14];case 9:if(u.trys.push([9,,12,13]),!(s&&!s.done&&(h=n.return)))return[3,11];return[4,o(h.call(n))];case 10:u.sent(),u.label=11;case 11:return[3,13];case 12:if(p)throw p.error;return[7];case 13:return[7];case 14:return[2]}})})})]}})})},FlatMap:function(e,t,r){var n=e.base,a=e.expr;return i(this,void 0,void 0,function(){var e;return u(this,function(s){switch(s.label){case 0:return[4,r(n,t)];case 1:if(!(e=s.sent()).isArray())return[2,m];return[2,new b(function(){return c(this,arguments,function(){var n,s,i,c,f,p,h,d,y,b,v,m,w,g;return u(this,function(u){switch(u.label){case 0:u.trys.push([0,23,24,29]),n=l(e),u.label=1;case 1:return[4,o(n.next())];case 2:if((s=u.sent()).done)return[3,22];return i=s.value,[4,o(r(a,t.createHidden(i)))];case 3:if(!(f=u.sent()).isArray())return[3,18];u.label=4;case 4:u.trys.push([4,11,12,17]),w=void 0,p=l(f),u.label=5;case 5:return[4,o(p.next())];case 6:if((h=u.sent()).done)return[3,10];return[4,o(h.value)];case 7:return[4,u.sent()];case 8:u.sent(),u.label=9;case 9:return[3,5];case 10:return[3,17];case 11:return w={error:u.sent()},[3,17];case 12:if(u.trys.push([12,,15,16]),!(h&&!h.done&&(g=p.return)))return[3,14];return[4,o(g.call(p))];case 13:u.sent(),u.label=14;case 14:return[3,16];case 15:if(w)throw w.error;return[7];case 16:return[7];case 17:return[3,21];case 18:return[4,o(f)];case 19:return[4,u.sent()];case 20:u.sent(),u.label=21;case 21:return[3,1];case 22:return[3,29];case 23:return v={error:u.sent()},[3,29];case 24:if(u.trys.push([24,,27,28]),!(s&&!s.done&&(m=n.return)))return[3,26];return[4,o(m.call(n))];case 25:u.sent(),u.label=26;case 26:return[3,28];case 27:if(v)throw v.error;return[7];case 28:return[7];case 29:return[2]}})})})]}})})}};function eh(e,t){void 0===t&&(t={});var r=A(t.root),n=A(t.dataset),a=s({},t.params),i=new ec(a,n,r,{timestamp:t.timestamp||new Date,identity:void 0===t.identity?"me":t.identity,sanity:t.sanity,after:t.after?A(t.after):null,before:t.before?A(t.before):null},null);return el(e,i)}var ed=new ec({},m,m,{timestamp:new Date(0),identity:"me",before:null,after:null},null);function ey(e){return!function e(t){switch(t.type){case"Group":case"Value":case"Parameter":return!0;case"Pos":case"Neg":return e(t.base);case"OpCall":switch(t.op){case"+":case"-":case"*":case"/":case"%":case"**":return e(t.left)&&e(t.right);default:return!1}default:return!1}}(e)?null:function e(t){var r=el(t,ed,e);if("then"in r)throw Error("BUG: constant evaluate should never return a promise");return r}(e)}var eb={"'":"'",'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"};function ev(e){return String.fromCharCode(parseInt(e,16))}var em=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="GroqQueryError",t}return a(t,e),t}(Error),ew={group:function(e){return{type:"Group",base:e.process(ew)}},everything:function(){return{type:"Everything"}},this:function(){return{type:"This"}},parent:function(){return{type:"Parent",n:1}},dblparent:function(e){return{type:"Parent",n:e.process(ew).n+1}},traverse:function(e){for(var t=e.process(ew),r=[];"traversal_end"!==e.getMark().name;)r.push(e.process(ek));e.shift();for(var n=null,a=r.length-1;a>=0;a--)n=r[a](n);if(("Everything"===t.type||"Array"===t.type||"PipeFuncCall"===t.type)&&(n=es(function(e){return e},n)),null===n)throw Error("BUG: unexpected empty traversal");return n.build(t)},this_attr:function(e){var t=e.processString();return"null"===t?{type:"Value",value:null}:"true"===t?{type:"Value",value:!0}:"false"===t?{type:"Value",value:!1}:{type:"AccessAttribute",name:t}},neg:function(e){return{type:"Neg",base:e.process(ew)}},pos:function(e){return{type:"Pos",base:e.process(ew)}},add:function(e){var t=e.process(ew),r=e.process(ew);return{type:"OpCall",op:"+",left:t,right:r}},sub:function(e){var t=e.process(ew),r=e.process(ew);return{type:"OpCall",op:"-",left:t,right:r}},mul:function(e){var t=e.process(ew),r=e.process(ew);return{type:"OpCall",op:"*",left:t,right:r}},div:function(e){var t=e.process(ew),r=e.process(ew);return{type:"OpCall",op:"/",left:t,right:r}},mod:function(e){var t=e.process(ew),r=e.process(ew);return{type:"OpCall",op:"%",left:t,right:r}},pow:function(e){var t=e.process(ew),r=e.process(ew);return{type:"OpCall",op:"**",left:t,right:r}},comp:function(e){var t=e.process(ew),r=e.processString(),n=e.process(ew);return{type:"OpCall",op:r,left:t,right:n}},in_range:function(e){var t=e.process(ew),r="inc_range"===e.getMark().name;e.shift();var n=e.process(ew),a=e.process(ew);return{type:"InRange",base:t,left:n,right:a,isInclusive:r}},str:function(e){var t="";loop:for(;e.hasMark();){var r=e.getMark();switch(r.name){case"str_end":t+=e.processStringEnd();break loop;case"str_pause":t+=e.processStringEnd();break;case"str_start":e.shift();break;case"single_escape":var n=e.slice(1);e.shift(),t+=eb[n];break;case"unicode_hex":e.shift(),t+=ev(e.processStringEnd());break;default:throw Error("unexpected mark: ".concat(r.name))}}return{type:"Value",value:t}},integer:function(e){return{type:"Value",value:Number(e.processStringEnd())}},float:function(e){return{type:"Value",value:Number(e.processStringEnd())}},sci:function(e){return{type:"Value",value:Number(e.processStringEnd())}},object:function(e){for(var t=[];"object_end"!==e.getMark().name;)t.push(e.process(eg));return e.shift(),{type:"Object",attributes:t}},array:function(e){for(var t=[];"array_end"!==e.getMark().name;){var r=!1;"array_splat"===e.getMark().name&&(r=!0,e.shift());var n=e.process(ew);t.push({type:"ArrayElement",value:n,isSplat:r})}return e.shift(),{type:"Array",elements:t}},tuple:function(e){for(var t=[];"tuple_end"!==e.getMark().name;)t.push(e.process(ew));return e.shift(),{type:"Tuple",members:t}},func_call:function(e){var t="global";"namespace"===e.getMark().name&&(e.shift(),t=e.processString());var r=e.processString();if("global"===t&&"select"===r){for(var n={type:"Select",alternatives:[]};"func_args_end"!==e.getMark().name;)if("pair"===e.getMark().name){if(n.fallback)throw new em("unexpected argument to select()");e.shift();var a=e.process(ew),s=e.process(ew);n.alternatives.push({type:"SelectAlternative",condition:a,value:s})}else{if(n.fallback)throw new em("unexpected argument to select()");var s=e.process(ew);n.fallback=s}return e.shift(),n}for(var i=[];"func_args_end"!==e.getMark().name;)eE(t,r,i.length)?(e.process(ex),i.push({type:"Selector"})):i.push(e.process(ew));if(e.shift(),"global"===t&&("before"===r||"after"===r)&&"delta"===e.parseOptions.mode)return{type:"Context",key:r};if("global"===t&&"boost"===r&&!e.allowBoost)throw new em("unexpected boost");var u=z[t];if(!u)throw new em("Undefined namespace: ".concat(t));var o=u[r];if(!o||(void 0!==o.arity&&e_(r,o.arity,i.length),void 0!==o.mode&&o.mode!==e.parseOptions.mode))throw new em("Undefined function: ".concat(r));return{type:"FuncCall",func:o,name:r,args:i}},pipecall:function(e){var t=e.process(ew);e.shift();var r="global";if("namespace"===e.getMark().name&&(e.shift(),r=e.processString()),"global"!==r)throw new em("Undefined namespace: ".concat(r));var n=e.processString(),a=[],s=e.allowBoost;for("score"===n&&(e.allowBoost=!0);;){var i=e.getMark().name;if("func_args_end"===i)break;if("order"===n){if("asc"===i){e.shift(),a.push({type:"Asc",base:e.process(ew)});continue}if("desc"===i){e.shift(),a.push({type:"Desc",base:e.process(ew)});continue}}a.push(e.process(ew))}e.shift(),e.allowBoost=s;var u=B[n];if(!u)throw new em("Undefined pipe function: ".concat(n));return u.arity&&e_(n,u.arity,a.length),{type:"PipeFuncCall",func:u,base:t,name:n,args:a}},pair:function(e){throw new em("unexpected =>")},and:function(e){var t=e.process(ew),r=e.process(ew);return{type:"And",left:t,right:r}},or:function(e){var t=e.process(ew),r=e.process(ew);return{type:"Or",left:t,right:r}},not:function(e){return{type:"Not",base:e.process(ew)}},asc:function(e){throw new em("unexpected asc")},desc:function(e){throw new em("unexpected desc")},param:function(e){var t=e.processString();return e.parseOptions.params&&e.parseOptions.params.hasOwnProperty(t)?{type:"Value",value:e.parseOptions.params[t]}:{type:"Parameter",name:t}}},eg={object_expr:function(e){if("pair"===e.getMark().name){e.shift();var t=e.process(ew),r=e.process(ew);return{type:"ObjectConditionalSplat",condition:t,value:r}}var n=e.process(ew);return{type:"ObjectAttributeValue",name:function e(t){if("AccessAttribute"===t.type&&!t.base)return t.name;if("Deref"===t.type||"Map"===t.type||"Projection"===t.type||"Slice"===t.type||"Filter"===t.type||"AccessElement"===t.type||"ArrayCoerce"===t.type)return e(t.base);throw new em("Cannot determine property key for type: ".concat(t.type))}(n),value:n}},object_pair:function(e){var t=e.process(ew);if("Value"!==t.type)throw Error("name must be string");var r=e.process(ew);return{type:"ObjectAttributeValue",name:t.value,value:r}},object_splat:function(e){return{type:"ObjectSplat",value:e.process(ew)}},object_splat_this:function(){return{type:"ObjectSplat",value:{type:"This"}}}},ek={square_bracket:function(e){var t=e.process(ew),r=ey(t);return r&&"number"===r.type?function(e){return function(e,t){if(!t)return{type:"a-b",build:e};switch(t.type){case"a-a":case"b-a":return{type:"a-a",build:en(e,t.build)};case"a-b":case"b-b":return{type:"a-b",build:en(e,t.build)};default:throw Error("unknown type: ".concat(t.type))}}(function(e){return{type:"AccessElement",base:e,index:r.data}},e)}:r&&"string"===r.type?function(e){return ei(function(e){return{type:"AccessAttribute",base:e,name:r.data}},e)}:function(e){return es(function(e){return{type:"Filter",base:e,expr:t}},e)}},slice:function(e){var t="inc_range"===e.getMark().name;e.shift();var r=e.process(ew),n=e.process(ew),a=ey(r),s=ey(n);if(!a||!s||"number"!==a.type||"number"!==s.type)throw new em("slicing must use constant numbers");return function(e){return es(function(e){return{type:"Slice",base:e,left:a.data,right:s.data,isInclusive:t}},e)}},projection:function(e){var t=e.process(ew);return function(e){return function(e,t){if(!t)return{type:"b-b",build:e};switch(t.type){case"a-a":return{type:"a-a",build:en(ea(e),t.build)};case"a-b":return{type:"a-b",build:en(ea(e),t.build)};case"b-a":return{type:"b-a",build:en(e,t.build)};case"b-b":return{type:"b-b",build:en(e,t.build)};default:throw Error("unknown type: ".concat(t.type))}}(function(e){return{type:"Projection",base:e,expr:t}},e)}},attr_access:function(e){var t=e.processString();return function(e){return ei(function(e){return{type:"AccessAttribute",base:e,name:t}},e)}},deref:function(e){var t=null;return"deref_attr"===e.getMark().name&&(e.shift(),t=e.processString()),function(e){return ei(function(e){var r;return r={type:"Deref",base:e},t?{type:"AccessAttribute",base:r,name:t}:r},e)}},array_postfix:function(e){return function(e){return es(function(e){return{type:"ArrayCoerce",base:e}},e)}}},ex={group:function(e){return e.process(ex),null},everything:function(){throw Error("Invalid selector syntax")},this:function(){throw Error("Invalid selector syntax")},parent:function(){throw Error("Invalid selector syntax")},dblparent:function(e){throw Error("Invalid selector syntax")},traverse:function(e){for(e.process(ex);"traversal_end"!==e.getMark().name;)e.process(ek);return e.shift(),null},this_attr:function(e){return e.processString(),null},neg:function(e){throw Error("Invalid selector syntax")},pos:function(e){throw Error("Invalid selector syntax")},add:function(e){throw Error("Invalid selector syntax")},sub:function(e){throw Error("Invalid selector syntax")},mul:function(e){throw Error("Invalid selector syntax")},div:function(e){throw Error("Invalid selector syntax")},mod:function(e){throw Error("Invalid selector syntax")},pow:function(e){throw Error("Invalid selector syntax")},comp:function(e){throw Error("Invalid selector syntax")},in_range:function(e){throw Error("Invalid selector syntax")},str:function(e){throw Error("Invalid selector syntax")},integer:function(e){throw Error("Invalid selector syntax")},float:function(e){throw Error("Invalid selector syntax")},sci:function(e){throw Error("Invalid selector syntax")},object:function(e){throw Error("Invalid selector syntax")},array:function(e){throw Error("Invalid selector syntax")},tuple:function(e){throw Error("Invalid selector syntax")},func_call:function(e,t){var r=ew.func_call(e,t);if("anywhere"===r.name&&1===r.args.length)return null;throw Error("Invalid selector syntax")},pipecall:function(e){throw Error("Invalid selector syntax")},pair:function(e){throw Error("Invalid selector syntax")},and:function(e){throw Error("Invalid selector syntax")},or:function(e){throw Error("Invalid selector syntax")},not:function(e){throw Error("Invalid selector syntax")},asc:function(e){throw Error("Invalid selector syntax")},desc:function(e){throw Error("Invalid selector syntax")},param:function(e){throw Error("Invalid selector syntax")}};function e_(e,t,r){if("number"==typeof t){if(r!==t)throw new em("Incorrect number of arguments to function ".concat(e,"(). Expected ").concat(t,", got ").concat(r,"."))}else if(t&&!t(r))throw new em("Incorrect number of arguments to function ".concat(e,"()."))}function eE(e,t,r){return"diff"==e&&2==r&&["changedAny","changedOnly"].includes(t)}var eA=function(e){function t(t){var r=e.call(this,"Syntax error in GROQ query at position ".concat(t))||this;return r.name="GroqSyntaxError",r.position=t,r}return a(t,e),t}(Error);function eS(e,t){void 0===t&&(t={});let r,n;var a,s=(r=ee(e,r=0),"error"===(n=L(e,r,0)).type?n:(r=ee(e,n.position))!==e.length?(n.failPosition&&(r=n.failPosition-1),{type:"error",position:r}):(delete n.position,delete n.failPosition,n));if("error"===s.type)throw new eA(s.position);return new f(e,s.marks,t).process(ew)}}}]);